<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mybatis.Reserve_mybatis">
<!-- 
	<select id="selectAllScreening" parameterType="ShowTimeDTO" resultType="ShowTimeDTO">
		select * from screening where screen_code = #{screen_code} and movie_code = #{movie_code} and screeningdate >= sysdate order by screeningdate asc, time asc
	</select>

	<select id="selectAllScreeningByDate" parameterType="ShowTimeDTO" resultType="ShowTimeDTO">
		select * from screening where screen_code = #{screen_code} and movie_code = #{movie_code} and screeningdate = #{screeningdate} order by theater_code asc, screeningdate asc, time asc
	</select>
 	
 	<select id="selectOneScreening" parameterType="String" resultType="ShowTimeDTO">		
		select s.*, m.title, m.rating, t.name from screening s join movie m on s.movie_code = m.movie_code join screen sc on s.screen_code = sc.screen_code join theater t on sc.theater_code = t.theater_code where s.screening_code = #{s.screening_code}
	</select>
	
	<select id="selectOneTheater" parameterType="TheaterDTO" resultType="TheaterDTO">
		select s.screen_code, sc.seats, sc.no, t.theater_code, t.name from screening s join screen sc on s.screen_code = sc.screen_code join theater t on sc.theater_code = t.theater_code where sc.screen_code = #{sc.screen_code} and t.theater_code = #{t.theater_code}
	</select>
 -->	

	<select id="selectAllReserve" parameterType="String" resultType="ReserveDTO">
		select * from reserve where screening_code = #{screening_code } order by seatnumber asc
	</select>

	<select id="selectReserveByID" parameterType="ReserveDTO" resultType="ReserveDTO">
		select * from reserve where id = #{id} order by seatnumber asc
	</select>
</mapper> 














<!-- testQuery 1
select * from screening 
where screen_code = '5'
and movie_code = '7' 
and screeningdate >= sysdate 
order by screeningdate asc, time asc; 
2
select * from screening 
where screen_code = '5'
and movie_code = '7' 
and screeningdate = '17/12/01'
order by theatercode asc, screeningdate asc, time asc;
	
3
select s.*, m.title, m.rating, t.name
from screening s
join movie m
on s.movie_code = m.movie_code
join screen sc
on s.screen_code = sc.screen_code
join theater t
on sc.theater_code = t.theater_code
where s.screening_code = '5'
;
	
	
4
select s.screen_code, sc.seats, sc.no, t.theater_code, t.name
from screening s
join screen sc
on s.screen_code = sc.screen_code
join theater t
on sc.theater_code = t.theater_code
where sc.screen_code = '5'
and t.theater_code = '4';

5
select * from reserve where screening_code = '5' order by seatnumber asc;


6
select * from reserve where id = 'HANSOIN1' order by seatnumber asc;

-->


<!-- 
<insert id="insertReserve" parameterType="ReserveDTO">
		insert into reserve values(SEQ_RESERVE.NEXTVAL, #{screening_code}, #{seatnumber}, #{r_id}, 'TRUE', sysdate, null)
	</insert>
	
	<insert id="insertReserveEtc" parameterType="ReserveDTO">
		insert into reserve values(SEQ_RESERVE.CURRVAL, #{screening_code}, #{seatnumber}, #{r_id}, 'TRUE', sysdate, null)
	</insert> 
	
	<update id="updateReserve" parameterType="String">
		update reserve set r_reservedate=sysdate where code=#{code}
	</update>
	
	
		
	<select id="selectAllReserveByMember" parameterType="String" resultType="ReserveDTO">
		select r.*, s.time, s.screeningdate from reserve r, screening s where r.r_id = #{r_id} and r.screening_code=s.screening_code and s.screeningdate>=sysdate order by s.screeningdate,s.time,r.seatnumber asc
	</select>
	
	<select id="selectAllReserveCancel" parameterType="String" resultType="ReserveDTO">
		select r.*, s.time, s.screeningdate from reserve r, screening s where r.r_id = #{r_id} and r.screening_code=s.screening_code order by s.screeningdate,s.time,r.seatnumber asc
	</select> 

	<select id="selectAllReserveAfter" parameterType="String" resultType="ReserveDTO">
		select r.*, s.time, s.screeningdate from reserve r, screening s where r.r_id = #{r_id} and r.screening_code=s.screening_code order by s.screeningdate,s.time,r.seatnumber asc
	</select>
 -->